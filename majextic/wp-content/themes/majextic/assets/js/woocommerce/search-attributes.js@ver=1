(function($){"use strict";const widget=$('.search_compatibility','.majextic-shop-before-search-attributes');widget.each(function(){const ajaxUrl=widget.data('ajax-url');const nonce=widget.data('nonce');const selects=widget.find('select');const button=widget.find('button');selects.select2({width:'resolve',}).on('select2:open',function(e){$(this).data('select2').$dropdown.addClass('select2-search-compatibility');})
let selectedVehicle;widget.on('majextic-vehicle-select.change',function(event,vehicle){selectedVehicle=vehicle;});button.on('click',function(event){event.preventDefault();if(selectedVehicle){window.location.href=selectedVehicle;}});selects.on('change',function(){const control=$(this);const item=control.closest('.majextic-vehicle-select__item');const index=widget.find('.majextic-vehicle-select__item').index(item);const value=control.val();const currentItem=widget.find('.majextic-vehicle-select__item').slice(index,index+1);const nextItem=widget.find('.majextic-vehicle-select__item').slice(index+1,index+2);const nextAllItems=widget.find('.majextic-vehicle-select__item').slice(index+1);const data={};widget.find('.majextic-vehicle-select__item').slice(0,index+1).find('select').each(function(){data[this.name]=JSON.parse(this.value);});if(value!=='null'){nextAllItems.addClass('majextic-vehicle-select__item--disabled');nextAllItems.removeClass('majextic-vehicle-select__item--activate');nextAllItems.find('select').prop('disabled',true).val('null');nextItem.removeClass('majextic-vehicle-select__item--disabled');nextItem.removeClass('majextic-vehicle-select__item--activate');nextItem.find('select').prop('disabled',false);currentItem.addClass('majextic-vehicle-select__item--activate');}else{nextAllItems.addClass('majextic-vehicle-select__item--disabled');nextAllItems.removeClass('majextic-vehicle-select__item--activate');nextAllItems.find('select').prop('disabled',true).val('null');}
nextAllItems.find('select').trigger('change.select2');if('null'===value){widget.trigger('majextic-vehicle-select.change',null);}else if(index+1===widget.find('.majextic-vehicle-select__item').length){widget.trigger('majextic-vehicle-select.change',JSON.parse(item.find('select').val()));}else{widget.trigger('majextic-vehicle-select.change',null);nextItem.addClass('majextic-vehicle-select__item--loading');$.post(ajaxUrl,{action:'majextic_sputnik_vehicle_select_load_data',nonce:nonce,data:{for:nextItem.find('select').prop('name'),values:data,},},function(response){if(response.success){nextItem.find('select option:not([value="null"])').remove();response.data.forEach(function(optionData){const option=$('<option></option>');option.text(optionData.title);option.attr('value',JSON.stringify(optionData.value));nextItem.find('select').append(option);});nextItem.removeClass('majextic-vehicle-select__item--loading');}});}});});})(jQuery);